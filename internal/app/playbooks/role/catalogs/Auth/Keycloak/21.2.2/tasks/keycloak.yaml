---

######## keycloak #########

- name: 8.8.1. Add Helm repository
  ansible.builtin.shell:
    cmd: "helm repo add bitnami https://charts.bitnami.com/bitnami"
  tags:
    - keycloak
  
- name: 8.8.2. Update Helm repositories
  ansible.builtin.shell:
    cmd: "helm repo update"
  tags:
    - keycloak

- name:  8.8.3. keycloak 설치
  shell: |
    helm upgrade -i  keycloak bitnami/keycloak --version 21.2.2  \
      --namespace keycloak \
      --create-namespace \
      --set auth.adminUser=admin \
      --set auth.adminPassword=admin1234 \
      --set global.storageClass=longhorn \
      --set ingress.enabled=true \
      --set ingress.hostname="keycloak.cnstudio.com" \
      --set ingress.tls=true \
      --set ingress.selfsigned=true \
      --set tls.enabled=true \
      --set tls.autoGenerated=true
  register: output
  tags:
    - keycloak

- debug:
    var: output
  tags: 
    - keycloak
    - keycloak-ingress

